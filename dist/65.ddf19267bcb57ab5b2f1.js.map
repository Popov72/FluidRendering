{"version":3,"file":"65.ddf19267bcb57ab5b2f1.js","mappings":"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","sources":["webpack://babylonjs-fluid-rendering/./src/scenes/fluidSimulationDemoHeightMap.ts"],"sourcesContent":["import * as BABYLON from \"@babylonjs/core\";\r\n\r\nimport { FluidSimulationDemoBase } from \"./fluidSimulationDemoBase\";\r\nimport { ParticleGenerator } from \"./Utils/particleGenerator\";\r\nimport { ICollisionShape } from \"./Utils/sdfHelper\";\r\n\r\nexport class FluidSimulationDemoHeightMap extends FluidSimulationDemoBase {\r\n    private _particleGeneratorName: string;\r\n    private _sphere: BABYLON.Nullable<BABYLON.Mesh>;\r\n    private _box: BABYLON.Nullable<BABYLON.Mesh>;\r\n    private _heightMap: [\r\n        BABYLON.Nullable<BABYLON.Mesh>,\r\n        BABYLON.Nullable<ICollisionShape>\r\n    ];\r\n    private _ground: BABYLON.Mesh;\r\n    private _groundCollision: ICollisionShape;\r\n    private _time: number;\r\n    private _showHeightmap: boolean;\r\n\r\n    constructor(scene: BABYLON.Scene) {\r\n        super(scene, false);\r\n\r\n        this._numParticles = 10000;\r\n        this._particleGeneratorName = \"Water jet\";\r\n        this._time = 0;\r\n        this._showHeightmap = true;\r\n        this._sphere = null;\r\n        this._box = null;\r\n        this._heightMap = [null, null];\r\n        this._groundCollision = null as any;\r\n\r\n        const terrainSize = 2.85;\r\n\r\n        this.addCollisionSphere(new BABYLON.Vector3(0, 0.2, 0), 0.2, null);\r\n        this.addCollisionBox(\r\n            new BABYLON.Vector3(-0.7, 0.249, -0.7),\r\n            new BABYLON.Vector3(0, 0, (90 * Math.PI) / 180),\r\n            new BABYLON.Vector3(0.2, 0.05, 0.5)\r\n        );\r\n\r\n        this.addCollisionTerrain(terrainSize);\r\n\r\n        this.addCollisionPlane(new BABYLON.Vector3(0, 0, -1), terrainSize / 2);\r\n        this.addCollisionPlane(new BABYLON.Vector3(0, 0, 1), terrainSize / 2);\r\n        this.addCollisionPlane(new BABYLON.Vector3(1, 0, 0), terrainSize / 2);\r\n        this.addCollisionPlane(new BABYLON.Vector3(-1, 0, 0), terrainSize / 2);\r\n        this.addCollisionPlane(new BABYLON.Vector3(0, 1, 0), 0);\r\n\r\n        this._ground = BABYLON.MeshBuilder.CreateGround(\r\n            \"ground\",\r\n            { width: terrainSize, height: terrainSize },\r\n            this._scene\r\n        );\r\n        this._ground.setEnabled(false);\r\n    }\r\n\r\n    public async _run() {\r\n        // Get collision meshes\r\n        this._sphere = this._collisionObjects[0][0];\r\n        this._box = this._collisionObjects[1][0];\r\n        this._heightMap = this._collisionObjects[2];\r\n        this._groundCollision = this._collisionObjects[7][1];\r\n\r\n        this._groundCollision.disabled = true;\r\n        this._ground.material = this._heightMap[0]!.material;\r\n\r\n        const camera =\r\n            this._scene.activeCameras?.[0] ?? this._scene.activeCamera;\r\n\r\n        if (camera) {\r\n            (camera as BABYLON.ArcRotateCamera).alpha = 4.65;\r\n            (camera as BABYLON.ArcRotateCamera).beta = 1.12;\r\n            (camera as BABYLON.ArcRotateCamera).radius = 3.9;\r\n        }\r\n\r\n        this._fluidRenderObject.targetRenderer.blurThicknessFilterSize = 12;\r\n        this._fluidRenderObject.targetRenderer.blurThicknessNumIterations = 3;\r\n        this._fluidRenderObject.targetRenderer.specularPower = 50;\r\n        this._fluidRenderObject.targetRenderer.refractionStrength = 0.02;\r\n        this._fluidRenderObject.targetRenderer.density = 5;\r\n\r\n        this._createParticleGenerator();\r\n\r\n        super._run();\r\n    }\r\n\r\n    private _createParticleGenerator(): void {\r\n        this._particleGenerator?.dispose();\r\n\r\n        let particleSize = \"\";\r\n\r\n        switch (this._particleGeneratorName) {\r\n            case \"Water jet\":\r\n                this._fluidRenderObject.object.particleSize = 0.08;\r\n\r\n                this._fluidSim!.smoothingRadius = 0.04;\r\n                this._fluidSim!.densityReference = 20000;\r\n                this._fluidSim!.pressureConstant = 3;\r\n                this._fluidSim!.viscosity = 0.01;\r\n                this._fluidSim!.maxVelocity = 3;\r\n                this._fluidSim!.maxAcceleration = 2000;\r\n                break;\r\n            case \"Dragon 0.04\":\r\n            case \"Dude 0.04\":\r\n            case \"Sphere 0.04\":\r\n                this._fluidRenderObject.object.particleSize = 0.08;\r\n\r\n                this._fluidSim!.smoothingRadius = 0.08;\r\n                this._fluidSim!.densityReference = 6000;\r\n                this._fluidSim!.pressureConstant = 10;\r\n                this._fluidSim!.viscosity = 0.01;\r\n                this._fluidSim!.maxVelocity = 4;\r\n                this._fluidSim!.maxAcceleration = 2000;\r\n\r\n                particleSize = \"04\";\r\n                break;\r\n            case \"Dragon 0.03\":\r\n            case \"Dude 0.03\":\r\n            case \"Sphere 0.03\":\r\n                this._fluidRenderObject.object.particleSize = 0.06;\r\n\r\n                this._fluidSim!.smoothingRadius = 0.06;\r\n                this._fluidSim!.densityReference = 17000;\r\n                this._fluidSim!.pressureConstant = 15;\r\n                this._fluidSim!.viscosity = 0.01;\r\n                this._fluidSim!.maxVelocity = 4;\r\n                this._fluidSim!.maxAcceleration = 2000;\r\n\r\n                particleSize = \"03\";\r\n                break;\r\n        }\r\n\r\n        this._fluidRendererGUI?.syncGUI();\r\n        this._syncFluidSimGUI();\r\n\r\n        this._particleGenerator = new ParticleGenerator(\r\n            this._scene,\r\n            particleSize === \"\"\r\n                ? undefined\r\n                : this._particleGeneratorName\r\n                      .substring(0, this._particleGeneratorName.indexOf(\" \"))\r\n                      .toLocaleLowerCase() +\r\n                  \"_\" +\r\n                  particleSize\r\n        );\r\n\r\n        this._particleGenerator!.position.y = 2;\r\n        this._particleGenerator!.position.z = 0.3;\r\n        this._particleGenerator.particleRadius =\r\n            this._fluidSim!.smoothingRadius / 2;\r\n    }\r\n\r\n    public dispose() {\r\n        super.dispose();\r\n\r\n        this._ground.dispose();\r\n    }\r\n\r\n    protected _makeGUIMainMenu(): void {\r\n        const params = {\r\n            restart: () => {\r\n                this._generateParticles();\r\n            },\r\n            particleGeneratorName: this._particleGeneratorName,\r\n            showHeightmap: this._showHeightmap,\r\n        };\r\n\r\n        const mainMenu = this._gui!;\r\n\r\n        mainMenu.add(params, \"restart\").name(\"Restart\");\r\n\r\n        mainMenu\r\n            .add(params, \"particleGeneratorName\", [\r\n                \"Water jet\",\r\n                \"Dragon 0.04\",\r\n                \"Dude 0.04\",\r\n                \"Sphere 0.04\",\r\n                \"Dragon 0.03\",\r\n                \"Dude 0.03\",\r\n                \"Sphere 0.03\",\r\n            ])\r\n            .name(\"Particle generator\")\r\n            .onChange(async (value: any) => {\r\n                this._particleGeneratorName = value;\r\n                this._createParticleGenerator();\r\n                await this._generateParticles();\r\n                if (value !== \"Water jet\") {\r\n                    this._numParticles =\r\n                        this._particleGenerator!.currNumParticles;\r\n                }\r\n                this._syncFluidSimGUI();\r\n            });\r\n\r\n        mainMenu\r\n            .add(params, \"showHeightmap\")\r\n            .name(\"Show height map\")\r\n            .onChange((value: boolean) => {\r\n                this._showHeightmap = value;\r\n                this._ground.setEnabled(!value);\r\n                this._groundCollision.disabled = value;\r\n                this._heightMap[0]!.setEnabled(value);\r\n                this._heightMap[1]!.disabled = !value;\r\n            });\r\n    }\r\n\r\n    protected _checkCollisions(particleRadius: number): void {\r\n        this._sphere!.position.x = Math.cos((2 * this._time) / 3.3) * 1.1;\r\n        this._sphere!.position.z = Math.sin((5 * this._time) / 3.3) * 1.1;\r\n\r\n        this._box!.rotation.y = this._time * 2;\r\n\r\n        this._time += 0.02;\r\n\r\n        super._checkCollisions(particleRadius);\r\n    }\r\n}\r\n"],"names":["FluidSimulationDemoHeightMap","FluidSimulationDemoBase","constructor","scene","super","this","_numParticles","_particleGeneratorName","_time","_showHeightmap","_sphere","_box","_heightMap","_groundCollision","terrainSize","addCollisionSphere","addCollisionBox","Math","PI","addCollisionTerrain","addCollisionPlane","_ground","width","height","_scene","setEnabled","async","_collisionObjects","disabled","material","camera","activeCameras","activeCamera","alpha","beta","radius","_fluidRenderObject","targetRenderer","blurThicknessFilterSize","blurThicknessNumIterations","specularPower","refractionStrength","density","_createParticleGenerator","_run","_particleGenerator","dispose","particleSize","object","_fluidSim","smoothingRadius","densityReference","pressureConstant","viscosity","maxVelocity","maxAcceleration","_fluidRendererGUI","syncGUI","_syncFluidSimGUI","ParticleGenerator","undefined","substring","indexOf","toLocaleLowerCase","position","y","z","particleRadius","_makeGUIMainMenu","params","restart","_generateParticles","particleGeneratorName","showHeightmap","mainMenu","_gui","add","name","onChange","value","currNumParticles","_checkCollisions","x","cos","sin","rotation"],"sourceRoot":""}