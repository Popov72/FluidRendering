"use strict";(self.webpackChunkbabylonjs_fluid_rendering=self.webpackChunkbabylonjs_fluid_rendering||[]).push([[30],{4030:(e,t,s)=>{s.r(t),s.d(t,{FluidSimulationDemoBoxSphere:()=>n});var i=s(6291),o=s(9820);class n extends o.FluidSimulationDemoBase{constructor(e){super(e),this._boxMin=new i.Vector3(-.3,-.3,-.7),this._boxMax=new i.Vector3(.3,1.2,.7),this._boxMesh=null,this._boxMaterial=null,this._boxMeshFront=null,this._boxMaterialFront=null,this._checkXZBounds=!0,this._origCollisionPlanes=[new i.Plane(0,0,-1,Math.abs(this._boxMax.z)),new i.Plane(0,0,1,Math.abs(this._boxMin.z)),new i.Plane(1,0,0,Math.abs(this._boxMin.x)),new i.Plane(-1,0,0,Math.abs(this._boxMax.x)),new i.Plane(0,-1,0,Math.abs(this._boxMax.y)),new i.Plane(0,1,0,Math.abs(this._boxMin.y)),new i.Plane(0,1,0,Math.abs(this._boxMin.y))],this._collisionPlanes=[];for(let e=0;e<this._origCollisionPlanes.length;++e){const t=this._origCollisionPlanes[e];this.addCollisionPlane(t.normal,t.d,e===this._origCollisionPlanes.length-1?.98:void 0)}this._angleX=0,this._angleY=0,this._prevTransfo=i.Matrix.Identity(),this._autoRotateBox=!1,this._sceneRenderObserver=null,this._sceneAfterCameraRenderObserver=null,this._sceneKeyboardObserver=null,this._onEngineResizeObserver=null,this._passPP=new i.PassPostProcess("pass",1,null,void 0,this._engine),this._passPP.externalTextureSamplerBinding=!0,this._sphereMesh=null,this.addCollisionSphere(new i.Vector3((this._boxMin.x+this._boxMax.x)/2,this._boxMin.y+.16,(this._boxMin.z+this._boxMax.z)/2-.1),.16),this._wallMesh=null,this.addCollisionBox(new i.Vector3(0,0,.3),new i.Vector3(90*Math.PI/180,0,0),new i.Vector3(.32,.05,.3),new i.Vector3(1,0,0))}async _run(){var e,t;for(let e=0;e<this._origCollisionPlanes.length;++e)this._collisionPlanes.push(this._collisionObjects[e]);this._collisionPlanes[this._collisionPlanes.length-1][1].disabled=!0,this._sphereMesh=this._collisionObjects[this._origCollisionPlanes.length][0],this._wallMesh=this._collisionObjects[this._origCollisionPlanes.length+1][0];const s=null!==(t=null===(e=this._scene.activeCameras)||void 0===e?void 0:e[0])&&void 0!==t?t:this._scene.activeCamera;s&&(s.alpha=3.06,s.beta=1.14,s.radius=2.96,s.outputRenderTarget=new i.RenderTargetTexture("rttFinal",{width:this._engine.getRenderWidth(),height:this._engine.getRenderHeight()},this._scene)),this._fluidRenderObject.object.particleSize=.08,this._fluidSim.smoothingRadius=.04,this._fluidSim.densityReference=2e4,this._fluidSim.pressureConstant=4,this._fluidSim.viscosity=.01,this._fluidSim.maxVelocity=3,this._fluidSim.maxAcceleration=2e3,this._boxMaterial=new i.PBRMaterial("BoxMeshMat",this._scene),this._boxMaterial.metallic=.3,this._boxMaterial.roughness=0,this._boxMaterial.alpha=.2,this._boxMaterial.backFaceCulling=!0,this._boxMaterial.cullBackFaces=!1,this._boxMaterialFront=this._boxMaterial.clone("BoxMeshFrontMat"),this._boxMaterialFront.cullBackFaces=!0,this._boxMesh=i.MeshBuilder.CreateBox("boxMesh",{width:this._boxMax.x-this._boxMin.x,height:this._boxMax.y-this._boxMin.y,depth:this._boxMax.z-this._boxMin.z},this._scene),this._boxMesh.material=this._boxMaterial,this._boxMesh.position.x=(this._boxMin.x+this._boxMax.x)/2,this._boxMesh.position.y=(this._boxMin.y+this._boxMax.y)/2,this._boxMesh.position.z=(this._boxMin.z+this._boxMax.z)/2,this._boxMesh.isPickable=!1,this._boxMeshFront=this._boxMesh.clone("boxMeshFront"),this._boxMeshFront.material=this._boxMaterialFront,this._boxMeshFront.layerMask=268435456;let o=!1,n=!1,a=!1,h=!1;this._scene.onKeyboardObservable.add((e=>{switch(e.type){case i.KeyboardEventTypes.KEYDOWN:"ArrowLeft"===e.event.code?o=!0:"ArrowRight"===e.event.code?n=!0:"ArrowUp"===e.event.code?a=!0:"ArrowDown"===e.event.code&&(h=!0);break;case i.KeyboardEventTypes.KEYUP:"ArrowLeft"===e.event.code?o=!1:"ArrowRight"===e.event.code?n=!1:"ArrowUp"===e.event.code?a=!1:"ArrowDown"===e.event.code&&(h=!1)}})),this._passPP.onApplyObservable.add((e=>{e.setTexture("textureSampler",s.outputRenderTarget)}));let r=!1;this._sceneAfterCameraRenderObserver=this._scene.onAfterCameraRenderObservable.add((()=>{var e;const t=null==s?void 0:s._getFirstPostProcess();t&&t.inputTexture.depthStencilTexture&&!r&&(t.inputTexture._shareDepth(s.outputRenderTarget.renderTarget),r=!0),r&&(null===(e=this._boxMeshFront)||void 0===e||e.render(this._boxMeshFront.subMeshes[0],!0),this._scene.postProcessManager.directRender([this._passPP],null))})),this._onEngineResizeObserver=this._engine.onResizeObservable.add((()=>{var e;null===(e=null==s?void 0:s.outputRenderTarget)||void 0===e||e.resize({width:this._engine.getRenderWidth(!0),height:this._engine.getRenderHeight(!0)}),r=!1})),this._sceneRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{if(o&&(this._angleX+=1,this._rotateMeshes(this._angleX,this._angleY)),n&&(this._angleX-=1,this._rotateMeshes(this._angleX,this._angleY)),a&&(this._angleY-=1,this._rotateMeshes(this._angleX,this._angleY)),h&&(this._angleY+=1,this._rotateMeshes(this._angleX,this._angleY)),this._autoRotateBox){const e=this._engine.getFps();this._angleX+=20/e,this._angleY+=30/e,this._rotateMeshes(this._angleX,this._angleY)}})),super._run()}dispose(){var e,t,s,i,o,n;super.dispose();const a=null!==(t=null===(e=this._scene.activeCameras)||void 0===e?void 0:e[0])&&void 0!==t?t:this._scene.activeCamera;a&&(null===(s=a.outputRenderTarget)||void 0===s||s.dispose(),a.outputRenderTarget=null),this._scene.onBeforeRenderObservable.remove(this._sceneRenderObserver),this._scene.onAfterCameraRenderObservable.remove(this._sceneAfterCameraRenderObserver),this._scene.onKeyboardObservable.remove(this._sceneKeyboardObserver),this._passPP.dispose(),null===(i=this._boxMesh)||void 0===i||i.dispose(),null===(o=this._boxMeshFront)||void 0===o||o.dispose(),null===(n=this._boxMaterial)||void 0===n||n.dispose(),this._engine.onResizeObservable.remove(this._onEngineResizeObserver)}_makeGUIMainMenu(){const e={checkXZBounds:!0,autoRotateBox:!1,restart:()=>{this._angleX=this._angleY=0,this._autoRotateBox=!1,null==s||s.setValue(!1),this._rotateMeshes(0,0),this._generateParticles()},boxOpacity:this._boxMaterial.alpha},t=this._gui;let s=null;t.add(e,"restart").name("Restart"),t.add(e,"checkXZBounds").name("Check box bounds").onChange((e=>{var t,i;this._checkXZBounds=e,null===(t=this._boxMesh)||void 0===t||t.setEnabled(e),null===(i=this._boxMeshFront)||void 0===i||i.setEnabled(e);for(let t=0;t<this._collisionPlanes.length;++t)this._collisionPlanes[t][1].disabled=!e&&t<this._collisionPlanes.length-1||e&&t===this._collisionPlanes.length-1;e||(this._autoRotateBox=!1,null==s||s.setValue(!1))})),s=t.add(e,"autoRotateBox").name("Auto rotate box").onChange((e=>{this._autoRotateBox=e})),t.add(e,"boxOpacity",0,1,.01).name("Box opacity").onChange((e=>{this._boxMaterial.alpha=e,this._boxMaterialFront.alpha=e}))}_onPaused(e){super._onPaused(e),e&&(this._autoRotateBox=!1)}_rotateMeshes(e,t){var s;const o=i.Matrix.RotationYawPitchRoll(0,e*Math.PI/180,t*Math.PI/180),n=[new i.Vector3(this._boxMin.x,this._boxMin.y,this._boxMin.z),new i.Vector3(this._boxMin.x,this._boxMax.y,this._boxMin.z),new i.Vector3(this._boxMin.x,this._boxMax.y,this._boxMax.z),new i.Vector3(this._boxMin.x,this._boxMin.y,this._boxMax.z),new i.Vector3(this._boxMax.x,this._boxMin.y,this._boxMin.z),new i.Vector3(this._boxMax.x,this._boxMax.y,this._boxMin.z),new i.Vector3(this._boxMax.x,this._boxMax.y,this._boxMax.z),new i.Vector3(this._boxMax.x,this._boxMin.y,this._boxMax.z)];let a=1e10;for(let e=0;e<n.length;++e){const t=i.Vector3.TransformCoordinates(n[e],o);a=Math.min(a,t.y)}this._collisionPlanes[this._origCollisionPlanes.length-1][1].params[1]=Math.abs(a)+.02;for(let e=0;e<this._origCollisionPlanes.length-1;++e){const t=this._origCollisionPlanes[e].transform(o);this._collisionPlanes[e][1].params=[t.normal,t.d]}const h=i.Quaternion.FromRotationMatrix(o);if(this._prevTransfo.invert(),this._sphereMesh){const e=i.Vector3.TransformCoordinates(this._sphereMesh.position,this._prevTransfo);this._sphereMesh.rotationQuaternion=h,this._sphereMesh.position=i.Vector3.TransformCoordinates(e,o)}if(this._wallMesh){const e=i.Vector3.TransformCoordinates(this._wallMesh.position,this._prevTransfo),t=i.Matrix.RotationYawPitchRoll(0,90*Math.PI/180,0),n=i.Matrix.Translation(e.x,e.y,e.z);t.multiplyToRef(n,t).multiplyToRef(o,t);const a=null!==(s=this._wallMesh.rotationQuaternion)&&void 0!==s?s:new i.Quaternion;t.decompose(void 0,a,this._wallMesh.position),this._wallMesh.rotationQuaternion=a}this._boxMesh&&this._boxMeshFront&&(this._boxMesh.rotationQuaternion=this._boxMeshFront.rotationQuaternion=h,this._boxMesh.position.x=(this._boxMin.x+this._boxMax.x)/2,this._boxMesh.position.y=(this._boxMin.y+this._boxMax.y)/2,this._boxMesh.position.z=(this._boxMin.z+this._boxMax.z)/2,this._boxMesh.position=i.Vector3.TransformCoordinates(this._boxMesh.position,o),this._boxMeshFront.position=this._boxMesh.position),this._prevTransfo.copyFrom(o)}}}}]);
//# sourceMappingURL=30.1b2997161a2c71b5d09d.js.map