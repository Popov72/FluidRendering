{"version":3,"file":"282.1ae0f8b64d37f692c8ec.js","mappings":"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","sources":["webpack://babylonjs-fluid-rendering/./src/scenes/Utils/particleGenerator.ts"],"sourcesContent":["import * as BABYLON from \"@babylonjs/core\";\r\n\r\nexport class ParticleGenerator {\r\n    private _scene: BABYLON.Scene;\r\n    private _observer: BABYLON.Nullable<BABYLON.Observer<BABYLON.Scene>>;\r\n    private _currNumParticles: number;\r\n    private _numCrossSection: number;\r\n    private _numParticles = 0;\r\n    private _positions: Float32Array;\r\n    private _velocities: Float32Array;\r\n    private _loadFromFile: string | undefined;\r\n\r\n    public particleRadius: number;\r\n\r\n    public position: BABYLON.Vector3;\r\n\r\n    public get currNumParticles() {\r\n        return this._currNumParticles;\r\n    }\r\n\r\n    public get positions() {\r\n        return this._positions;\r\n    }\r\n\r\n    public get velocities() {\r\n        return this._velocities;\r\n    }\r\n\r\n    constructor(scene: BABYLON.Scene, loadFromFile?: string) {\r\n        this._scene = scene;\r\n        this._currNumParticles = 0;\r\n        this._numCrossSection = 0;\r\n        this._positions = new Float32Array();\r\n        this._velocities = new Float32Array();\r\n        this.particleRadius = 0;\r\n        this._loadFromFile = loadFromFile;\r\n        this.position = new BABYLON.Vector3(0, 0, 0);\r\n\r\n        if (!this._loadFromFile) {\r\n            this._observer = scene.onBeforeRenderObservable.add(() => {\r\n                if (this._currNumParticles === 0) {\r\n                    if (this._positions.length / 3 >= this._numCrossSection) {\r\n                        this._currNumParticles = this._numCrossSection;\r\n                    }\r\n                } else if (this._currNumParticles < this._numParticles) {\r\n                    const px1 = this._positions[this._currNumParticles * 3 + 0];\r\n                    const py1 = this._positions[this._currNumParticles * 3 + 1];\r\n                    const pz1 = this._positions[this._currNumParticles * 3 + 2];\r\n\r\n                    const px2 =\r\n                        this._positions[\r\n                            (this._currNumParticles - this._numCrossSection) *\r\n                                3 +\r\n                                0\r\n                        ];\r\n                    const py2 =\r\n                        this._positions[\r\n                            (this._currNumParticles - this._numCrossSection) *\r\n                                3 +\r\n                                1\r\n                        ];\r\n                    const pz2 =\r\n                        this._positions[\r\n                            (this._currNumParticles - this._numCrossSection) *\r\n                                3 +\r\n                                2\r\n                        ];\r\n\r\n                    const dist = Math.sqrt(\r\n                        (px1 - px2) * (px1 - px2) +\r\n                            (py1 - py2) * (py1 - py2) +\r\n                            (pz1 - pz2) * (pz1 - pz2)\r\n                    );\r\n\r\n                    if (dist > this.particleRadius * 2) {\r\n                        this._currNumParticles += this._numCrossSection;\r\n                    }\r\n                }\r\n            });\r\n        } else {\r\n            this._observer = null;\r\n        }\r\n    }\r\n\r\n    public async generateParticles(\r\n        numTotParticles: number,\r\n        regenerateAll = true\r\n    ) {\r\n        if (this._loadFromFile) {\r\n            await this._generateParticlesFromFile(this._loadFromFile);\r\n        } else {\r\n            this._generateParticles(numTotParticles, regenerateAll);\r\n        }\r\n    }\r\n\r\n    private async _generateParticlesFromFile(fileName: string) {\r\n        const data = await (\r\n            await fetch(`../src/assets/particles/${fileName}.txt`)\r\n        ).text();\r\n\r\n        const lines = data.replace(\"\\r\", \"\").split(\"\\n\");\r\n\r\n        const particlePos = [];\r\n        const particleVel = [];\r\n\r\n        let numParticles = 0;\r\n\r\n        for (let i = 1; i < lines.length; ++i) {\r\n            const line = lines[i];\r\n            const vals = line.split(\",\");\r\n            if (line.charAt(0) === '\"' || vals.length < 4) {\r\n                continue;\r\n            }\r\n            particlePos.push(\r\n                parseFloat(vals[1]) + this.position.x,\r\n                parseFloat(vals[2]) + +this.position.y,\r\n                parseFloat(vals[3]) + this.position.z\r\n            );\r\n            particleVel.push(0, 0, 0);\r\n            numParticles++;\r\n        }\r\n\r\n        const particleStartIndex = 0;\r\n\r\n        this._numParticles = this._numCrossSection = numParticles;\r\n\r\n        if (this._numParticles > this._positions.length / 3) {\r\n            const newPositions = new Float32Array(this._numParticles * 3);\r\n            const newVelocities = new Float32Array(this._numParticles * 3);\r\n\r\n            newPositions.set(this._positions, 0);\r\n            newVelocities.set(this._velocities, 0);\r\n\r\n            this._positions = newPositions;\r\n            this._velocities = newVelocities;\r\n        }\r\n\r\n        this._positions.set(particlePos, particleStartIndex * 3);\r\n        this._velocities.set(particleVel, particleStartIndex * 3);\r\n\r\n        this._currNumParticles = this._numParticles;\r\n    }\r\n\r\n    private _generateParticles(\r\n        numTotParticles: number,\r\n        regenerateAll = true\r\n    ): void {\r\n        if (this._numParticles >= numTotParticles && !regenerateAll) {\r\n            this._numParticles = numTotParticles;\r\n            this._currNumParticles = Math.min(\r\n                this._currNumParticles,\r\n                this._numParticles\r\n            );\r\n            return;\r\n        }\r\n\r\n        const dimX = 12,\r\n            dimY = 12;\r\n\r\n        const particlePos = [];\r\n        const particleVel = [];\r\n\r\n        const distance = this.particleRadius * 2;\r\n        const jitter = distance * 0.1;\r\n        const getJitter = () => Math.random() * jitter - jitter / 2;\r\n\r\n        const particleStartIndex = regenerateAll ? 0 : this._currNumParticles;\r\n\r\n        this._numParticles = particleStartIndex;\r\n\r\n        while (this._numParticles <= numTotParticles - this._numCrossSection) {\r\n            let yCoord = (dimY / 2) * distance;\r\n\r\n            this._numCrossSection = 0;\r\n            for (let y = 1; y < dimY - 1; ++y) {\r\n                const angle = (y * Math.PI) / (dimY - 1);\r\n\r\n                let x2 = ((Math.sin(angle) * dimX) / 2) * distance;\r\n                if (x2 < 0) {\r\n                    x2 = 0;\r\n                }\r\n\r\n                let xCoord = -x2;\r\n                while (xCoord <= x2) {\r\n                    const xc =\r\n                        xCoord === -x2 || xCoord + distance > x2\r\n                            ? xCoord\r\n                            : xCoord + getJitter();\r\n                    const yc =\r\n                        xCoord === -x2 || xCoord + distance > x2\r\n                            ? yCoord\r\n                            : yCoord + getJitter();\r\n                    const zCoord =\r\n                        xCoord === -x2 || xCoord + distance > x2\r\n                            ? 0.49\r\n                            : 0.49 + getJitter();\r\n                    particlePos.push(\r\n                        xc + this.position.x,\r\n                        yc + this.position.y,\r\n                        zCoord + this.position.z\r\n                    );\r\n                    particleVel.push(\r\n                        (Math.random() - 0.5) * 0.03,\r\n                        (Math.random() - 0.5) * 0.03,\r\n                        (Math.random() - 1.0) * 0.03 - 1.5\r\n                    );\r\n                    xCoord += distance;\r\n                    this._numParticles++;\r\n                    this._numCrossSection++;\r\n                }\r\n\r\n                yCoord += distance;\r\n            }\r\n        }\r\n\r\n        if (this._numParticles > this._positions.length / 3) {\r\n            const newPositions = new Float32Array(this._numParticles * 3);\r\n            const newVelocities = new Float32Array(this._numParticles * 3);\r\n\r\n            newPositions.set(this._positions, 0);\r\n            newVelocities.set(this._velocities, 0);\r\n\r\n            this._positions = newPositions;\r\n            this._velocities = newVelocities;\r\n        }\r\n\r\n        this._positions.set(particlePos, particleStartIndex * 3);\r\n        this._velocities.set(particleVel, particleStartIndex * 3);\r\n\r\n        this._currNumParticles = particleStartIndex;\r\n    }\r\n\r\n    public dispose(): void {\r\n        this._scene.onBeforeRenderObservable.remove(this._observer);\r\n        this._observer = null;\r\n    }\r\n}\r\n"],"names":["ParticleGenerator","constructor","scene","loadFromFile","_numParticles","this","_scene","_currNumParticles","_numCrossSection","_positions","Float32Array","_velocities","particleRadius","_loadFromFile","position","_observer","onBeforeRenderObservable","add","length","px1","py1","pz1","px2","py2","pz2","Math","sqrt","currNumParticles","positions","velocities","async","numTotParticles","regenerateAll","_generateParticlesFromFile","_generateParticles","fileName","lines","fetch","text","replace","split","particlePos","particleVel","numParticles","i","line","vals","charAt","push","parseFloat","x","y","z","newPositions","newVelocities","set","particleStartIndex","min","distance","jitter","getJitter","random","yCoord","dimY","angle","PI","x2","sin","xCoord","xc","yc","zCoord","dispose","remove"],"sourceRoot":""}