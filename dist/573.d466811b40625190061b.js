"use strict";(self.webpackChunkbabylonjs_fluid_rendering=self.webpackChunkbabylonjs_fluid_rendering||[]).push([[573,499],{7499:(e,t,i)=>{i.r(t),i.d(t,{FluidRenderingObject:()=>s});var r=i(6291);class s{constructor(e,t,i){this.vertexBuffers=t,this.indexBuffer=i,this.priority=0,this._particleSize=.1,this.onParticleSizeChanged=new r.Observable,this.particleThicknessAlpha=.05,this._useVelocity=!1,this._scene=e,this._engine=e.getEngine(),this._effectsAreDirty=!0,this._depthEffectWrapper=null,this._thicknessEffectWrapper=null}get particleSize(){return this._particleSize}set particleSize(e){e!==this._particleSize&&(this._particleSize=e,this.onParticleSizeChanged.notifyObservers(this))}get useInstancing(){return!this.indexBuffer}get useVelocity(){return this._useVelocity}set useVelocity(e){this._useVelocity!==e&&this._hasVelocity()&&(this._useVelocity=e,this._effectsAreDirty=!0)}_hasVelocity(){return!!this.vertexBuffers.velocity}getClassName(){return"FluidRenderingObject"}_createEffects(){const e=["view","projection","particleRadius","size"],t=["position","offset"],i=[];this._effectsAreDirty=!1,this.useVelocity&&(t.push("velocity"),i.push("#define FLUIDRENDERING_VELOCITY")),this._depthEffectWrapper=new r.EffectWrapper({engine:this._engine,useShaderStore:!0,vertexShader:"fluidParticleDepth",fragmentShader:"fluidParticleDepth",attributeNames:t,uniformNames:e,samplerNames:[],defines:i}),e.push("particleAlpha"),this._thicknessEffectWrapper=new r.EffectWrapper({engine:this._engine,useShaderStore:!0,vertexShader:"fluidParticleThickness",fragmentShader:"fluidParticleThickness",attributeNames:["position","offset"],uniformNames:e,samplerNames:[]})}isReady(){if(this._effectsAreDirty&&this._createEffects(),!this._depthEffectWrapper||!this._thicknessEffectWrapper)return!1;const e=this._depthEffectWrapper._drawWrapper.effect,t=this._thicknessEffectWrapper._drawWrapper.effect;return e.isReady()&&t.isReady()}numParticles(){return 0}renderDepthTexture(){const e=this.numParticles();if(!this._depthEffectWrapper||0===e)return;const t=this._depthEffectWrapper._drawWrapper,i=t.effect;this._engine.enableEffect(t),this._engine.bindBuffers(this.vertexBuffers,this.indexBuffer,i),i.setMatrix("view",this._scene.getViewMatrix()),i.setMatrix("projection",this._scene.getProjectionMatrix()),i.setFloat2("size",this._particleSize,this._particleSize),i.setFloat("particleRadius",this._particleSize/2),this.useInstancing?this._engine.drawArraysType(r.Constants.MATERIAL_TriangleStripDrawMode,0,4,e):this._engine.drawElementsType(r.Constants.MATERIAL_TriangleFillMode,0,e)}renderThicknessTexture(){const e=this.numParticles();if(!this._thicknessEffectWrapper||0===e)return;const t=this._thicknessEffectWrapper._drawWrapper,i=t.effect;this._engine.setAlphaMode(r.Constants.ALPHA_ONEONE),this._engine.setDepthWrite(!1),this._engine.enableEffect(t),this._engine.bindBuffers(this.vertexBuffers,this.indexBuffer,i),i.setMatrix("view",this._scene.getViewMatrix()),i.setMatrix("projection",this._scene.getProjectionMatrix()),i.setFloat("particleAlpha",this.particleThicknessAlpha),i.setFloat2("size",this._particleSize,this._particleSize),this.useInstancing?this._engine.drawArraysType(r.Constants.MATERIAL_TriangleStripDrawMode,0,4,e):this._engine.drawElementsType(r.Constants.MATERIAL_TriangleFillMode,0,e),this._engine.setDepthWrite(!0),this._engine.setAlphaMode(r.Constants.ALPHA_DISABLE)}renderDiffuseTexture(){}dispose(){var e,t;null===(e=this._depthEffectWrapper)||void 0===e||e.dispose(),null===(t=this._thicknessEffectWrapper)||void 0===t||t.dispose()}}},8573:(e,t,i)=>{i.r(t),i.d(t,{FluidRenderingObjectParticleSystem:()=>n});var r=i(6291),s=i(7499);class n extends s.FluidRenderingObject{constructor(e,t){super(e,t.vertexBuffers,t.indexBuffer),this._useTrueRenderingForDiffuseTexture=!0,this._particleSystem=t,this._renderCallback=t.render.bind(t),this._blendMode=t.blendMode,this._onBeforeDrawParticleObserver=null,t.render=()=>0,this.particleSize=(t.minSize+t.maxSize)/2,this.useTrueRenderingForDiffuseTexture=!1}get particleSystem(){return this._particleSystem}getClassName(){return"FluidRenderingObjectParticleSystem"}get useTrueRenderingForDiffuseTexture(){return this._useTrueRenderingForDiffuseTexture}set useTrueRenderingForDiffuseTexture(e){this._useTrueRenderingForDiffuseTexture!==e&&(this._useTrueRenderingForDiffuseTexture=e,e?(this._particleSystem.blendMode=this._blendMode,this._particleSystem.onBeforeDrawParticlesObservable.remove(this._onBeforeDrawParticleObserver),this._onBeforeDrawParticleObserver=null):(this._particleSystem.blendMode=-1,this._onBeforeDrawParticleObserver=this._particleSystem.onBeforeDrawParticlesObservable.add((()=>{this._engine.setAlphaMode(r.Constants.ALPHA_COMBINE)}))))}isReady(){return super.isReady()&&this._particleSystem.isReady()}numParticles(){return this._particleSystem.getActiveCount()}renderDiffuseTexture(){this._renderCallback()}dispose(){super.dispose(),this._particleSystem.onBeforeDrawParticlesObservable.remove(this._onBeforeDrawParticleObserver),this._onBeforeDrawParticleObserver=null,this._particleSystem.render=this._renderCallback,this._particleSystem.blendMode=this._blendMode}}}}]);
//# sourceMappingURL=573.d466811b40625190061b.js.map