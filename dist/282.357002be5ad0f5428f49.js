"use strict";(self.webpackChunkbabylonjs_fluid_rendering=self.webpackChunkbabylonjs_fluid_rendering||[]).push([[282],{4282:(s,t,i)=>{i.r(t),i.d(t,{ParticleGenerator:()=>r});var e=i(6291);class r{constructor(s,t){this._numParticles=0,this._scene=s,this._currNumParticles=0,this._numCrossSection=0,this._positions=new Float32Array,this._velocities=new Float32Array,this.particleRadius=0,this._loadFromFile=t,this.position=new e.Vector3(0,0,0),this._loadFromFile?this._observer=null:this._observer=s.onBeforeRenderObservable.add((()=>{if(0===this._currNumParticles)this._positions.length/3>=this._numCrossSection&&(this._currNumParticles=this._numCrossSection);else if(this._currNumParticles<this._numParticles){const s=this._positions[3*this._currNumParticles+0],t=this._positions[3*this._currNumParticles+1],i=this._positions[3*this._currNumParticles+2],e=this._positions[3*(this._currNumParticles-this._numCrossSection)+0],r=this._positions[3*(this._currNumParticles-this._numCrossSection)+1],o=this._positions[3*(this._currNumParticles-this._numCrossSection)+2];Math.sqrt((s-e)*(s-e)+(t-r)*(t-r)+(i-o)*(i-o))>2*this.particleRadius&&(this._currNumParticles+=this._numCrossSection)}}))}get currNumParticles(){return this._currNumParticles}get positions(){return this._positions}get velocities(){return this._velocities}async generateParticles(s,t=!0){this._loadFromFile?await this._generateParticlesFromFile(this._loadFromFile):this._generateParticles(s,t)}async _generateParticlesFromFile(s){const t=(await(await fetch(`assets/particles/${s}.txt`)).text()).replace("\r","").split("\n"),i=[],e=[];let r=0;for(let s=1;s<t.length;++s){const o=t[s],n=o.split(",");'"'===o.charAt(0)||n.length<4||(i.push(parseFloat(n[1])+this.position.x,parseFloat(n[2])+ +this.position.y,parseFloat(n[3])+this.position.z),e.push(0,0,0),r++)}if(this._numParticles=this._numCrossSection=r,this._numParticles>this._positions.length/3){const s=new Float32Array(3*this._numParticles),t=new Float32Array(3*this._numParticles);s.set(this._positions,0),t.set(this._velocities,0),this._positions=s,this._velocities=t}this._positions.set(i,0),this._velocities.set(e,0),this._currNumParticles=this._numParticles}_generateParticles(s,t=!0){if(this._numParticles>=s&&!t)return this._numParticles=s,void(this._currNumParticles=Math.min(this._currNumParticles,this._numParticles));const i=[],e=[],r=2*this.particleRadius,o=.1*r,n=()=>Math.random()*o-o/2,h=t?0:this._currNumParticles;for(this._numParticles=h;this._numParticles<=s-this._numCrossSection;){let s=6*r;this._numCrossSection=0;for(let t=1;t<11;++t){const o=t*Math.PI/11;let h=12*Math.sin(o)/2*r;h<0&&(h=0);let a=-h;for(;a<=h;){const t=a===-h||a+r>h?a:a+n(),o=a===-h||a+r>h?s:s+n(),c=a===-h||a+r>h?.49:.49+n();i.push(t+this.position.x,o+this.position.y,c+this.position.z),e.push(.03*(Math.random()-.5),.03*(Math.random()-.5),.03*(Math.random()-1)-1.5),a+=r,this._numParticles++,this._numCrossSection++}s+=r}}if(this._numParticles>this._positions.length/3){const s=new Float32Array(3*this._numParticles),t=new Float32Array(3*this._numParticles);s.set(this._positions,0),t.set(this._velocities,0),this._positions=s,this._velocities=t}this._positions.set(i,3*h),this._velocities.set(e,3*h),this._currNumParticles=h}dispose(){this._scene.onBeforeRenderObservable.remove(this._observer),this._observer=null}}}}]);
//# sourceMappingURL=282.357002be5ad0f5428f49.js.map