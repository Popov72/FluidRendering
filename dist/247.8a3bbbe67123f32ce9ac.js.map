{"version":3,"file":"247.8a3bbbe67123f32ce9ac.js","mappings":"yLAEO,MAAMA,EAeTC,YAAYC,EAAwBC,EAAeC,GAV3C,KAAAC,eAEJ,GASAC,KAAKC,QAAUL,EACfI,KAAKE,OAASL,EACdG,KAAKG,QAAUL,EAEfE,KAAKI,gBAAkBJ,KAAKC,QAAQI,0BAChC,CAAER,MAAAA,EAAOC,OAAAA,GACT,CACIQ,iBAAiB,EACjBC,KAAM,sCACNC,OAAQ,4BACRC,aAAc,yCACdC,qBAAqB,EACrBC,uBAAuB,EACvBC,QAAS,EACTC,eAAe,IAGvBb,KAAKI,gBAAgBU,0BAA0B,GAAG,GAAO,EAAO,GAEhEd,KAAKe,mBAAqB,IAAI,gBAAsB,CAChDnB,OAAQI,KAAKC,QACbe,gBAAgB,EAChBC,aAAc,YACdC,eAAgB,YAChBC,eAAgB,CAAC,YACjBC,aAAc,GACdC,aAAc,CAAC,gBACfC,eAAgB1B,EAAO2B,SACjB,sBACA,wBAIV,MAAMC,EAAW,GACjBA,EAASC,KAAK,EAAG,GACjBD,EAASC,MAAM,EAAG,GAClBD,EAASC,MAAM,GAAI,GACnBD,EAASC,KAAK,GAAI,GAElBzB,KAAKD,eAAe,6BAChB,IAAI,eACAC,KAAKC,QACLuB,EACA,6BACA,GACA,EACA,GAIR,MAAME,EAAU,GAChBA,EAAQD,KAAK,GACbC,EAAQD,KAAK,GACbC,EAAQD,KAAK,GAEbC,EAAQD,KAAK,GACbC,EAAQD,KAAK,GACbC,EAAQD,KAAK,GAEbzB,KAAK2B,aAAe3B,KAAKC,QAAQ2B,kBAAkBF,GAhE5CG,qBACP,OAAO7B,KAAKI,gBAkET0B,KAAKC,GACR,MAAMC,EAAShC,KAAKe,mBAAmBiB,OAEvC,IAAKA,EAAOC,UACR,OAAO,EAGXjC,KAAKC,QAAQiC,gBAAgBlC,KAAKI,iBAElCJ,KAAKC,QAAQkC,aAAanC,KAAKe,mBAAmBqB,cAElD,MAAMC,EAAkBrC,KAAKC,QAAQqC,mBA2BrC,OAzBAtC,KAAKC,QAAQsC,UAAS,GACtBvC,KAAKC,QAAQuC,gBAAe,GAC5BxC,KAAKC,QAAQwC,eAAc,GAC3BzC,KAAKC,QAAQyC,iBAAiB,oBAC9B1C,KAAKC,QAAQ0C,eAAc,GAE3B3C,KAAKC,QAAQ2C,YACT5C,KAAKD,eACLC,KAAK2B,aACLK,GAGJA,EAAOa,aAAa,eAAgBd,GAEpC/B,KAAKC,QAAQ6C,iBACT,sCACA,EACA,GAGJ9C,KAAKC,QAAQyC,iBAAiBL,GAC9BrC,KAAKC,QAAQ0C,eAAc,GAE3B3C,KAAKC,QAAQ8C,kBAAkB/C,KAAKI,kBAE7B,EAGJ4C,U,MACHhD,KAAKI,gBAAgB4C,UAEiC,QAAtD,EAAAhD,KAAKD,eAAe,oCAAkC,SAAEiD,UACxDhD,KAAKD,eAAiB,GAElBC,KAAK2B,eACL3B,KAAKC,QAAQgD,eAAejD,KAAK2B,cACjC3B,KAAK2B,aAAe","sources":["webpack://babylonjs-fluid-rendering/./src/scenes/Utils/copyDepthTexture.ts"],"sourcesContent":["import * as BABYLON from \"@babylonjs/core\";\r\n\r\nexport class CopyDepthTexture {\r\n    private _engine: BABYLON.Engine;\r\n    private _width: number;\r\n    private _height: number;\r\n    private _indexBuffer: BABYLON.Nullable<BABYLON.DataBuffer>;\r\n    private _vertexBuffers: {\r\n        [key: string]: BABYLON.Nullable<BABYLON.VertexBuffer>;\r\n    } = {};\r\n    private _depthRTWrapper: BABYLON.RenderTargetWrapper;\r\n    private _copyEffectWrapper: BABYLON.EffectWrapper;\r\n\r\n    public get depthRTWrapper() {\r\n        return this._depthRTWrapper;\r\n    }\r\n\r\n    constructor(engine: BABYLON.Engine, width: number, height: number) {\r\n        this._engine = engine;\r\n        this._width = width;\r\n        this._height = height;\r\n\r\n        this._depthRTWrapper = this._engine.createRenderTargetTexture(\r\n            { width, height },\r\n            {\r\n                generateMipMaps: false,\r\n                type: BABYLON.Constants.TEXTURETYPE_UNSIGNED_BYTE,\r\n                format: BABYLON.Constants.TEXTUREFORMAT_R,\r\n                samplingMode: BABYLON.Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n                generateDepthBuffer: true,\r\n                generateStencilBuffer: false,\r\n                samples: 1,\r\n                noColorTarget: true,\r\n            }\r\n        );\r\n        this._depthRTWrapper.createDepthStencilTexture(0, false, false, 1);\r\n\r\n        this._copyEffectWrapper = new BABYLON.EffectWrapper({\r\n            engine: this._engine,\r\n            useShaderStore: true,\r\n            vertexShader: \"passDepth\",\r\n            fragmentShader: \"passDepth\",\r\n            attributeNames: [\"position\"],\r\n            uniformNames: [],\r\n            samplerNames: [\"textureDepth\"],\r\n            shaderLanguage: engine.isWebGPU\r\n                ? BABYLON.ShaderLanguage.WGSL\r\n                : BABYLON.ShaderLanguage.GLSL,\r\n        });\r\n\r\n        // VBO\r\n        const vertices = [];\r\n        vertices.push(1, 1);\r\n        vertices.push(-1, 1);\r\n        vertices.push(-1, -1);\r\n        vertices.push(1, -1);\r\n\r\n        this._vertexBuffers[BABYLON.VertexBuffer.PositionKind] =\r\n            new BABYLON.VertexBuffer(\r\n                this._engine,\r\n                vertices,\r\n                BABYLON.VertexBuffer.PositionKind,\r\n                false,\r\n                false,\r\n                2\r\n            );\r\n\r\n        // Indices\r\n        const indices = [];\r\n        indices.push(0);\r\n        indices.push(1);\r\n        indices.push(2);\r\n\r\n        indices.push(0);\r\n        indices.push(2);\r\n        indices.push(3);\r\n\r\n        this._indexBuffer = this._engine.createIndexBuffer(indices);\r\n    }\r\n\r\n    public copy(source: BABYLON.InternalTexture): boolean {\r\n        const effect = this._copyEffectWrapper.effect;\r\n\r\n        if (!effect.isReady()) {\r\n            return false;\r\n        }\r\n\r\n        this._engine.bindFramebuffer(this._depthRTWrapper!);\r\n\r\n        this._engine.enableEffect(this._copyEffectWrapper._drawWrapper);\r\n\r\n        const engineDepthFunc = this._engine.getDepthFunction();\r\n\r\n        this._engine.setState(false);\r\n        this._engine.setDepthBuffer(true);\r\n        this._engine.setDepthWrite(true);\r\n        this._engine.setDepthFunction(BABYLON.Constants.ALWAYS);\r\n        this._engine.setColorWrite(false);\r\n\r\n        this._engine.bindBuffers(\r\n            this._vertexBuffers,\r\n            this._indexBuffer,\r\n            effect\r\n        );\r\n\r\n        effect._bindTexture(\"textureDepth\", source);\r\n\r\n        this._engine.drawElementsType(\r\n            BABYLON.Constants.MATERIAL_TriangleFillMode,\r\n            0,\r\n            6\r\n        );\r\n\r\n        this._engine.setDepthFunction(engineDepthFunc!);\r\n        this._engine.setColorWrite(true);\r\n\r\n        this._engine.unBindFramebuffer(this._depthRTWrapper!);\r\n\r\n        return true;\r\n    }\r\n\r\n    public dispose() {\r\n        this._depthRTWrapper.dispose();\r\n\r\n        this._vertexBuffers[BABYLON.VertexBuffer.PositionKind]?.dispose();\r\n        this._vertexBuffers = {};\r\n\r\n        if (this._indexBuffer) {\r\n            this._engine._releaseBuffer(this._indexBuffer);\r\n            this._indexBuffer = null;\r\n        }\r\n    }\r\n}\r\n"],"names":["CopyDepthTexture","constructor","engine","width","height","_vertexBuffers","this","_engine","_width","_height","_depthRTWrapper","createRenderTargetTexture","generateMipMaps","type","format","samplingMode","generateDepthBuffer","generateStencilBuffer","samples","noColorTarget","createDepthStencilTexture","_copyEffectWrapper","useShaderStore","vertexShader","fragmentShader","attributeNames","uniformNames","samplerNames","shaderLanguage","isWebGPU","vertices","push","indices","_indexBuffer","createIndexBuffer","depthRTWrapper","copy","source","effect","isReady","bindFramebuffer","enableEffect","_drawWrapper","engineDepthFunc","getDepthFunction","setState","setDepthBuffer","setDepthWrite","setDepthFunction","setColorWrite","bindBuffers","_bindTexture","drawElementsType","unBindFramebuffer","dispose","_releaseBuffer"],"sourceRoot":""}